{"version":3,"sources":["functions/user.js","pages/Checkout.js"],"names":["userCart","cart","authtoken","a","axios","post","process","headers","getUserCart","get","emptyUserCart","delete","saveUserAddress","address","applyCoupon","coupon","createOrder","stripeResponse","getUserOrders","getWishlist","removeWishlist","productId","put","addToWishlist","createCashOrderForUser","COD","couponTrueOrFalse","couponApplied","Checkout","history","useState","products","setProducts","total","setTotal","setAddress","addressSaved","setAddressSaved","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","useDispatch","useSelector","state","user","useEffect","token","then","res","console","log","JSON","stringify","data","cartTotal","saveAddressToDb","ok","toast","success","applyDiscountCoupon","type","payload","err","className","theme","value","onChange","onClick","e","target","length","map","p","i","product","title","color","count","price","disabled","window","localStorage","removeItem","setTimeout","push"],"mappings":"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","file":"static/js/41.0d25f09e.chunk.js","sourcesContent":["import axios from \"axios\";\n\nexport const userCart = async (cart, authtoken) => {\n  return axios.post(\n    `${process.env.REACT_APP_API}/user/cart`,\n    { cart },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n};\n\nexport const getUserCart = async (authtoken) => {\n  return axios.get(`${process.env.REACT_APP_API}/user/cart`, {\n    headers: {\n      authtoken,\n    },\n  });\n};\n\nexport const emptyUserCart = async (authtoken) => {\n  return axios.delete(`${process.env.REACT_APP_API}/user/cart`, {\n    headers: {\n      authtoken,\n    },\n  });\n};\n\nexport const saveUserAddress = async (authtoken, address) => {\n  return axios.post(\n    `${process.env.REACT_APP_API}/user/address`,\n    { address },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n};\n\nexport const applyCoupon = async (authtoken, coupon) => {\n  return axios.post(\n    `${process.env.REACT_APP_API}/user/cart/coupon`,\n    { coupon },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n};\n\nexport const createOrder = async (stripeResponse, authtoken) => {\n  return axios.post(\n    `${process.env.REACT_APP_API}/user/order`,\n    { stripeResponse },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n};\n\nexport const getUserOrders = async (authtoken) => {\n  return axios.get(`${process.env.REACT_APP_API}/user/orders`, {\n    headers: {\n      authtoken,\n    },\n  });\n};\n\nexport const getWishlist = async (authtoken) => {\n  return axios.get(`${process.env.REACT_APP_API}/user/wishlist`, {\n    headers: {\n      authtoken,\n    },\n  });\n};\n\nexport const removeWishlist = async (productId, authtoken) => {\n  return axios.put(\n    `${process.env.REACT_APP_API}/user/wishlist/${productId}`,\n    {},\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n};\n\nexport const addToWishlist = async (productId, authtoken) => {\n  return axios.post(\n    `${process.env.REACT_APP_API}/user/wishlist`,\n    {\n      productId,\n    },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n};\n\nexport const createCashOrderForUser = async (\n  authtoken,\n  COD,\n  couponTrueOrFalse\n) => {\n  return axios.post(\n    `${process.env.REACT_APP_API}/user/cash-order`,\n    { couponApplied: couponTrueOrFalse, COD },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n};\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport {\n  getUserCart,\n  emptyUserCart,\n  saveUserAddress,\n  applyCoupon,\n} from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\nimport { createCashOrderForUser } from \"../functions/user\";\n\nconst Checkout = ({ history }) => {\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\");\n\n  // discount price\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n\n  const dispatch = useDispatch();\n\n  const { user, COD } = useSelector((state) => ({ ...state }));\n  const couponTrueOrFalse = useSelector((state) => state.coupon);\n\n  useEffect(() => {\n    getUserCart(user.token).then((res) => {\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n      setProducts(res.data.products);\n      setTotal(res.data.cartTotal);\n    });\n  }, []);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    }\n    // remove from redux\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: [],\n    });\n    // remove from backend\n    emptyUserCart(user.token).then((res) => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    saveUserAddress(user.token, address).then((res) => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address Saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    applyCoupon(user.token, coupon).then((res) => {\n      console.log(\"coupon applied\", res);\n      if (res.data) {\n        setTotalAfterDiscount(res.data);\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true,\n        });\n      }\n      if (res.data.err) {\n        setDiscountError(res.data.err);\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n      }\n    });\n  };\n\n  const showAddress = () => (\n    <>\n      <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\n      <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\n        Save\n      </button>\n    </>\n  );\n\n  const showProductSummary = () => {\n    return products.map((p, i) => (\n      <div key={i}>\n        <p>\n          {p.product.title} ({p.color}) x {p.count} ={\" \"}\n          {p.product.price * p.count}\n        </p>\n      </div>\n    ));\n  };\n\n  const showApplyCoupon = () => (\n    <>\n      <input\n        onChange={(e) => {\n          setCoupon(e.target.value);\n          setDiscountError(\"\");\n        }}\n        value={coupon}\n        type=\"text\"\n        className=\"form-control\"\n      />\n      <button onClick={applyDiscountCoupon} className=\"btn btn-primary mt-2\">\n        Apply\n      </button>\n    </>\n  );\n\n  const createCashOrder = () => {\n    createCashOrderForUser(user.token, COD, couponTrueOrFalse).then((res) => {\n      console.log(\"COD\", res);\n      if (res.data.ok) {\n        if (typeof window !== \"undefined\") localStorage.removeItem(\"cart\");\n\n        dispatch({\n          type: \"ADD_TO_CART\",\n          payload: [],\n        });\n\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n\n        dispatch({\n          type: \"COD\",\n          payload: false,\n        });\n\n        emptyUserCart(user.token);\n\n        setTimeout(() => {\n          history.push(\"/user/history\");\n        }, 1000);\n      }\n    });\n  };\n\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\">\n        <h4>Delivery Address</h4>\n        <br />\n        <br />\n        {showAddress()}\n        <hr />\n        <h4>Got Coupon?</h4>\n\n        {discountError && <p className=\"text-danger p-2\">{discountError}</p>}\n        {showApplyCoupon()}\n        <br />\n      </div>\n\n      <div className=\"col-md-6\">\n        <h4>Order Summary</h4>\n        <hr />\n        <p>Products {products.length}</p>\n        <hr />\n        {showProductSummary()}\n        <hr />\n        <p>Cart Total: {total}</p>\n\n        {totalAfterDiscount > 0 && (\n          <p className=\"text-success p-2\">\n            Coupon Applied!!\n            <br />\n            Total Payble: {totalAfterDiscount}\n          </p>\n        )}\n\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            {COD ? (\n              <button\n                disabled={!addressSaved || !products.length}\n                className=\"btn btn-primary\"\n                onClick={createCashOrder}\n              >\n                Place Order\n              </button>\n            ) : (\n              <button\n                disabled={!addressSaved || !products.length}\n                className=\"btn btn-primary\"\n                onClick={() => history.push(\"/payment\")}\n              >\n                Place Order\n              </button>\n            )}\n          </div>\n\n          <div className=\"col-md-6\">\n            <button\n              disabled={!products.length}\n              onClick={emptyCart}\n              className=\"btn btn-primary\"\n            >\n              Empty Cart\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout;\n"],"sourceRoot":""}