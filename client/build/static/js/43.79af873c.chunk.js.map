{"version":3,"sources":["pages/auth/Login.js"],"names":["Login","history","useState","email","setEmail","password","setPassword","loading","setLoading","dispatch","useDispatch","user","useSelector","state","useEffect","location","token","push","roleBasedRedirect","res","intended","from","data","role","handleSubmit","e","a","preventDefault","auth","signInWithEmailAndPassword","result","getIdTokenResult","idTokenResult","createOrUpdateUser","then","type","payload","name","_id","catch","err","console","log","toast","error","message","googleLogin","signInWithPopup","googleAuthProvider","className","onSubmit","value","onChange","target","placeholder","autoFocus","onClick","block","shape","icon","size","disabled","length","to"],"mappings":"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","file":"static/js/43.79af873c.chunk.js","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { auth, googleAuthProvider } from \"../../firebase\";\nimport { toast } from \"react-toastify\";\nimport { MailOutlined, GoogleOutlined } from \"@ant-design/icons\";\nimport { Button } from \"antd\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { createOrUpdateUser } from \"../../functions/auth\";\n\nconst Login = ({ history }) => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  let dispatch = useDispatch();\n\n  const { user } = useSelector((state) => ({ ...state }));\n\n  useEffect(() => {\n    let intended = history.location.state;\n    if (intended) {\n      return;\n    } else {\n      if (user && user.token) history.push(\"/\");\n    }\n  }, [user, history]);\n\n  const roleBasedRedirect = (res) => {\n    let intended = history.location.state;\n    if (intended) {\n      history.push(intended.from);\n    } else {\n      if (res.data.role === \"admin\") {\n        history.push(\"/admin/dashboard\");\n      } else {\n        history.push(\"/user/history\");\n      }\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    try {\n      const result = await auth.signInWithEmailAndPassword(email, password);\n      const { user } = result;\n      const idTokenResult = await user.getIdTokenResult();\n\n      createOrUpdateUser(idTokenResult.token)\n        .then((res) => {\n          dispatch({\n            type: \"LOGGED_IN_USER\",\n            payload: {\n              name: res.data.name,\n              email: res.data.email,\n              token: idTokenResult.token,\n              role: res.data.role,\n              _id: res.data._id,\n            },\n          });\n          roleBasedRedirect(res);\n        })\n        .catch((err) => console.log(err));\n    } catch (error) {\n      toast.error(error.message);\n      setLoading(false);\n    }\n  };\n\n  const googleLogin = async () => {\n    auth\n      .signInWithPopup(googleAuthProvider)\n      .then(async (result) => {\n        const { user } = result;\n        const idTokenResult = await user.getIdTokenResult();\n\n        createOrUpdateUser(idTokenResult.token)\n          .then((res) => {\n            dispatch({\n              type: \"LOGGED_IN_USER\",\n              payload: {\n                name: res.data.name,\n                email: res.data.email,\n                token: idTokenResult.token,\n                role: res.data.role,\n                _id: res.data._id,\n              },\n            });\n            roleBasedRedirect(res);\n          })\n          .catch((err) => console.log(err));\n      })\n      .catch((error) => {\n        toast.error(error.message);\n      });\n  };\n\n  const loginForm = () => (\n    <form onSubmit={handleSubmit}>\n      <div className=\"form-group\">\n        <input\n          type=\"email\"\n          className=\"form-control\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          placeholder=\"Email\"\n          autoFocus\n        />\n      </div>\n      <br />\n\n      <div className=\"form-group\">\n        <input\n          type=\"password\"\n          className=\"form-control\"\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n          placeholder=\"Password\"\n          autoFocus\n        />\n      </div>\n      <br />\n\n      <Button\n        onClick={handleSubmit}\n        type=\"primary\"\n        className=\"mb-2\"\n        block\n        shape=\"round\"\n        icon={<MailOutlined />}\n        size=\"large\"\n        disabled={!email || password.length < 6}\n      >\n        Login with Email/Password\n      </Button>\n    </form>\n  );\n  return (\n    <div className=\"container p-5\">\n      <div className=\"row\">\n        <div className=\"col-md-6 offset-md-3\">\n          {loading ? (\n            <h4 className=\"text-danger\">Loading...</h4>\n          ) : (\n            <h4>Login</h4>\n          )}\n          {loginForm()}\n\n          <Button\n            onClick={googleLogin}\n            type=\"danger\"\n            className=\"mb-3\"\n            block\n            shape=\"round\"\n            icon={<GoogleOutlined />}\n            size=\"large\"\n          >\n            Login with Google\n          </Button>\n          <Link className=\"float-right text-danger\" to=\"/forgot/password\">\n            Forgot Password\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Login;\n"],"sourceRoot":""}